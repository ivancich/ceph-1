From: Yehuda Sadeh <yehuda@redhat.com>
Date: Fri, 10 Jun 2016 14:34:41 -0700
Subject: rgw: rgw_obj comparison also accounts for bucket id

Signed-off-by: Yehuda Sadeh <yehuda@redhat.com>
(cherry picked from commit a7f32c4b1bd951b1a18b7d13013dc8e2822d6ffc)

Resolves: rhbz#1349285
---
 src/rgw/rgw_common.h | 17 ++++++++++-------
 1 file changed, 10 insertions(+), 7 deletions(-)

diff --git a/src/rgw/rgw_common.h b/src/rgw/rgw_common.h
index 39e0d4a..a907f44 100644
--- a/src/rgw/rgw_common.h
+++ b/src/rgw/rgw_common.h
@@ -1713,13 +1713,16 @@ public:
   bool operator<(const rgw_obj& o) const {
     int r = bucket.name.compare(o.bucket.name);
     if (r == 0) {
-     r = object.compare(o.object);
-     if (r == 0) {
-       r = ns.compare(o.ns);
-       if (r == 0) {
-         r = instance.compare(o.instance);
-       }
-     }
+      r = bucket.bucket_id.compare(o.bucket.bucket_id);
+      if (r == 0) {
+        r = object.compare(o.object);
+        if (r == 0) {
+          r = ns.compare(o.ns);
+          if (r == 0) {
+            r = instance.compare(o.instance);
+          }
+        }
+      }
     }
 
     return (r < 0);
